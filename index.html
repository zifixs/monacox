<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ULTIMATE Cookie Clicker</title>
    <style>
        :root {
            --primary: #FF9800;
            --primary-dark: #F57C00;
            --primary-light: #FFE0B2;
            --secondary: #8BC34A;
            --secondary-dark: #689F38;
            --accent: #FF5722;
            --background: #FFF8F0;
            --text: #5D4037;
            --text-light: #8D6E63;
            --shadow: 0 4px 8px rgba(0,0,0,0.1);
            --transition: all 0.3s ease;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(255,214,161,0.2) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(255,214,161,0.2) 0%, transparent 20%);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 2px solid var(--primary-light);
            margin-bottom: 30px;
        }
        
        .game-title {
            font-size: 2.5rem;
            color: var(--primary-dark);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            background: linear-gradient(to right, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .stats {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 5px;
        }
        
        .counter {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary-dark);
        }
        
        .cps-counter {
            font-size: 1.2rem;
            color: var(--text-light);
        }
        
        .main-game {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .cookie-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .cookie-container {
            position: relative;
            width: 300px;
            height: 300px;
            margin: 20px 0;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .cookie {
            width: 100%;
            height: 100%;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="%23D7CCC8" stroke="%235D4037" stroke-width="2"/><circle cx="30" cy="30" r="5" fill="%235D4037"/><circle cx="70" cy="30" r="7" fill="%235D4037"/><circle cx="40" cy="60" r="4" fill="%235D4037"/><circle cx="65" cy="65" r="3" fill="%235D4037"/><circle cx="25" cy="50" r="6" fill="%235D4037"/></svg>');
            background-size: contain;
            transition: var(--transition);
            filter: drop-shadow(var(--shadow));
        }
        
        .cookie:hover {
            transform: scale(1.05) rotate(5deg);
        }
        
        .cookie:active {
            transform: scale(0.95) rotate(-5deg);
        }
        
        .click-effect {
            position: absolute;
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent);
            animation: float-up 1s forwards;
            pointer-events: none;
            user-select: none;
            z-index: 10;
            text-shadow: 0 0 5px rgba(255,255,255,0.8);
        }
        
        @keyframes float-up {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-100px) scale(1.5); }
        }
        
        .upgrades-section {
            flex: 2;
            display: flex;
            flex-direction: column;
        }
        
        .upgrades-tabs {
            display: flex;
            border-bottom: 2px solid var(--primary-light);
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            font-weight: bold;
            color: var(--text-light);
            transition: var(--transition);
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            color: var(--primary-dark);
            border-bottom: 3px solid var(--primary);
        }
        
        .tab:hover:not(.active) {
            color: var(--text);
            background-color: rgba(255,152,0,0.1);
        }
        
        .upgrades-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            max-height: 500px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .upgrade {
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 2px solid var(--primary-light);
            cursor: pointer;
        }
        
        .upgrade:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            border-color: var(--primary);
        }
        
        .upgrade:active {
            transform: translateY(0);
        }
        
        .upgrade.disabled {
            opacity: 0.6;
            cursor: not-allowed;
            filter: grayscale(0.5);
        }
        
        .upgrade-name {
            font-size: 1.2rem;
            color: var(--primary-dark);
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
        }
        
        .upgrade-description {
            color: var(--text-light);
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        
        .upgrade-stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
        }
        
        .upgrade-price {
            font-weight: bold;
            color: var(--accent);
        }
        
        .upgrade-owned {
            color: var(--secondary-dark);
            font-weight: bold;
        }
        
        .progress-bar {
            height: 5px;
            background-color: #e0e0e0;
            border-radius: 5px;
            margin-top: 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, var(--primary), var(--accent));
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .achievements-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: var(--shadow);
            margin-top: 30px;
        }
        
        .section-title {
            font-size: 1.5rem;
            color: var(--primary-dark);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }
        
        .achievement {
            background: var(--primary-light);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            transition: var(--transition);
            border: 2px solid transparent;
        }
        
        .achievement.unlocked {
            background: var(--secondary);
            color: white;
            border-color: var(--secondary-dark);
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(139,195,74,0.3);
        }
        
        .achievement-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .achievement-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .achievement-description {
            font-size: 0.8rem;
            opacity: 0.8;
        }
        
        .prestige-section {
            background: linear-gradient(135deg, #673AB7, #9C27B0);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin-top: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .prestige-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
            margin-bottom: 15px;
        }
        
        .prestige-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .prestige-button {
            background: white;
            color: #673AB7;
            border: none;
            padding: 12px 25px;
            font-size: 1.1rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            display: block;
            margin: 0 auto;
        }
        
        .prestige-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }
        
        .prestige-button:active {
            transform: translateY(0);
        }
        
        .prestige-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .golden-cookie {
            position: fixed;
            width: 60px;
            height: 60px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="%23FFD54F" stroke="%23F57F17" stroke-width="3"/><circle cx="30" cy="30" r="5" fill="%23F57F17"/><circle cx="70" cy="30" r="7" fill="%23F57F17"/><circle cx="40" cy="60" r="4" fill="%23F57F17"/><circle cx="65" cy="65" r="3" fill="%23F57F17"/><circle cx="25" cy="50" r="6" fill="%23F57F17"/></svg>');
            background-size: contain;
            cursor: pointer;
            animation: pulse 2s infinite, float 5s infinite ease-in-out;
            z-index: 100;
            filter: drop-shadow(0 0 10px rgba(255,213,79,0.7));
            display: none;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        @keyframes float {
            0% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
            100% { transform: translateY(0) rotate(0deg); }
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px 20px;
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transform: translateX(200%);
            transition: transform 0.3s ease;
            z-index: 1000;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .save-buttons {
            display: flex;
            gap: 10px;
            margin-top: 30px;
            justify-content: center;
        }
        
        .game-button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: bold;
        }
        
        .game-button:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        .game-button:active {
            transform: translateY(0);
        }
        
        .game-button.secondary {
            background: var(--text-light);
        }
        
        .game-button.secondary:hover {
            background: var(--text);
        }
        
        .game-button.warning {
            background: #F44336;
        }
        
        .game-button.warning:hover {
            background: #D32F2F;
        }
        
        /* Анимация для особых событий */
        @keyframes rainbow {
            0% { color: #FF0000; }
            14% { color: #FF7F00; }
            28% { color: #FFFF00; }
            42% { color: #00FF00; }
            57% { color: #0000FF; }
            71% { color: #4B0082; }
            85% { color: #9400D3; }
            100% { color: #FF0000; }
        }
        
        .rainbow-text {
            animation: rainbow 3s linear infinite;
        }
        
        /* Адаптивность */
        @media (max-width: 768px) {
            .main-game {
                flex-direction: column;
            }
            
            .upgrades-container {
                grid-template-columns: 1fr;
            }
            
            .achievements-grid {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1 class="game-title">ULTIMATE COOKIE CLICKER</h1>
            <div class="stats">
                <div class="counter">Печенек: <span id="cookies">0</span></div>
                <div class="cps-counter">В секунду: <span id="cps">0</span></div>
            </div>
        </header>
        
        <div class="main-game">
            <div class="cookie-section">
                <div class="cookie-container" id="cookie-container">
                    <div class="cookie" id="cookie"></div>
                </div>
                <div id="click-multiplier">За клик: <span id="click-value">1</span></div>
            </div>
            
            <div class="upgrades-section">
                <div class="upgrades-tabs">
                    <div class="tab active" data-tab="producers">Производство</div>
                    <div class="tab" data-tab="click">Клик</div>
                    <div class="tab" data-tab="prestige">Престиж</div>
                </div>
                
                <div class="upgrades-container" id="producers-tab">
                    <!-- Производители будут добавлены через JS -->
                </div>
                
                <div class="upgrades-container" id="click-tab" style="display:none;">
                    <!-- Улучшения клика будут добавлены через JS -->
                </div>
                
                <div class="upgrades-container" id="prestige-tab" style="display:none;">
                    <!-- Престижные улучшения будут добавлены через JS -->
                </div>
            </div>
        </div>
        
        <div class="achievements-section">
            <h2 class="section-title">🏆 Достижения</h2>
            <div class="achievements-grid" id="achievements-container">
                <!-- Достижения будут добавлены через JS -->
            </div>
        </div>
        
        <div class="prestige-section">
            <h2 class="prestige-title">⭐ Престиж</h2>
            <div class="prestige-info">
                <div>Текущий уровень: <span id="prestige-level">0</span></div>
                <div>Бонус: x<span id="prestige-bonus">1</span></div>
            </div>
            <div>Престижных очков: <span id="prestige-points">0</span></div>
            <div>Следующий престиж: <span id="next-prestige">1,000,000</span> печенек</div>
            <button class="prestige-button" id="prestige-button" disabled>Престиж!</button>
        </div>
        
        <div class="save-buttons">
            <button class="game-button" id="save-btn">Сохранить</button>
            <button class="game-button secondary" id="load-btn">Загрузить</button>
            <button class="game-button warning" id="reset-btn">Сбросить</button>
        </div>
    </div>
    
    <div class="golden-cookie" id="golden-cookie"></div>
    
    <div class="notification" id="notification"></div>
    
    <script>
        // Игровые переменные
        let cookies = 0;
        let cookiesPerSecond = 0;
        let cookiesPerClick = 1;
        let totalCookiesClicked = 0;
        let totalCookiesProduced = 0;
        let prestigeLevel = 0;
        let prestigePoints = 0;
        let prestigeBonus = 1;
        let goldenCookiesClicked = 0;
        let gameVersion = "1.0.0";
        
        // Состояние игры
        let gameState = {
            lastUpdate: Date.now(),
            cookies: 0,
            upgrades: {},
            achievements: [],
            stats: {},
            prestige: {
                level: 0,
                points: 0,
                bonus: 1
            }
        };
        
        // Улучшения производства
        const producers = {
            cursor: {
                name: "Курсор",
                description: "Автоматически кликает по печеньке",
                basePrice: 15,
                price: 15,
                owned: 0,
                cps: 0.1,
                priceIncrease: 1.15,
                unlockAt: 0,
                icon: "🖱️"
            },
            grandma: {
                name: "Бабушка",
                description: "Печёт печенье для вас",
                basePrice: 100,
                price: 100,
                owned: 0,
                cps: 1,
                priceIncrease: 1.15,
                unlockAt: 10,
                icon: "👵"
            },
            farm: {
                name: "Ферма",
                description: "Выращивает пшеницу для печенья",
                basePrice: 1100,
                price: 1100,
                owned: 0,
                cps: 8,
                priceIncrease: 1.15,
                unlockAt: 50,
                icon: "🌾"
            },
            mine: {
                name: "Шахта",
                description: "Добывает сахар и минералы",
                basePrice: 12000,
                price: 12000,
                owned: 0,
                cps: 47,
                priceIncrease: 1.15,
                unlockAt: 200,
                icon: "⛏️"
            },
            factory: {
                name: "Фабрика",
                description: "Массовое производство печенья",
                basePrice: 130000,
                price: 130000,
                owned: 0,
                cps: 260,
                priceIncrease: 1.15,
                unlockAt: 1000,
                icon: "🏭"
            },
            bank: {
                name: "Банк",
                description: "Производит печенье из процентов",
                basePrice: 1400000,
                price: 1400000,
                owned: 0,
                cps: 1400,
                priceIncrease: 1.15,
                unlockAt: 5000,
                icon: "🏦"
            },
            temple: {
                name: "Храм",
                description: "Боги дарят вам печенье",
                basePrice: 20000000,
                price: 20000000,
                owned: 0,
                cps: 7800,
                priceIncrease: 1.15,
                unlockAt: 20000,
                icon: "🛕"
            },
            portal: {
                name: "Портал",
                description: "Печенье из других измерений",
                basePrice: 330000000,
                price: 330000000,
                owned: 0,
                cps: 44000,
                priceIncrease: 1.15,
                unlockAt: 100000,
                icon: "🌀"
            }
        };
        
        // Улучшения клика
        const clickUpgrades = {
            betterCursor: {
                name: "Улучшенный курсор",
                description: "Увеличивает печенье за клик на 0.1",
                basePrice: 100,
                price: 100,
                owned: 0,
                bonus: 0.1,
                priceIncrease: 1.5,
                max: 10,
                icon: "🖱️✨"
            },
            reinforcedClick: {
                name: "Усиленный клик",
                description: "Увеличивает печенье за клик на 1",
                basePrice: 500,
                price: 500,
                owned: 0,
                bonus: 1,
                priceIncrease: 1.8,
                max: 5,
                icon: "💪"
            },
            platinumClick: {
                name: "Платиновый клик",
                description: "Увеличивает печенье за клик на 5",
                basePrice: 10000,
                price: 10000,
                owned: 0,
                bonus: 5,
                priceIncrease: 2,
                max: 3,
                icon: "👑"
            },
            cosmicClick: {
                name: "Космический клик",
                description: "Увеличивает печенье за клик на 50",
                basePrice: 1000000,
                price: 1000000,
                owned: 0,
                bonus: 50,
                priceIncrease: 2.5,
                max: 1,
                icon: "🚀"
            }
        };
        
        // Престижные улучшения
        const prestigeUpgrades = {
            legacy: {
                name: "Наследие",
                description: "Увеличивает базовую эффективность всех производителей на 1%",
                basePrice: 1,
                price: 1,
                owned: 0,
                bonus: 0.01,
                priceIncrease: 1.2,
                max: 100,
                icon: "🏛️"
            },
            goldenLuck: {
                name: "Золотая удача",
                description: "Увеличивает шанс появления золотых печенек на 1%",
                basePrice: 5,
                price: 5,
                owned: 0,
                bonus: 0.01,
                priceIncrease: 1.3,
                max: 20,
                icon: "🍀"
            },
            cookieMaster: {
                name: "Мастер печенья",
                description: "Увеличивает все печенье за клик на 1%",
                basePrice: 10,
                price: 10,
                owned: 0,
                bonus: 0.01,
                priceIncrease: 1.4,
                max: 50,
                icon: "👨‍🍳"
            }
        };
        
        // Достижения
        const achievements = [
            { id: "first-cookie", name: "Первое печенье", description: "Кликните по печеньке 1 раз", threshold: 1, icon: "🍪" },
            { id: "hundred-cookies", name: "100 печенек", description: "Соберите 100 печенек", threshold: 100, icon: "💯" },
            { id: "thousand-cookies", name: "1,000 печенек", description: "Соберите 1,000 печенек", threshold: 1000, icon: "🔢" },
            { id: "million-cookies", name: "Миллионер", description: "Соберите 1,000,000 печенек", threshold: 1000000, icon: "💰" },
            { id: "first-producer", name: "Первый производитель", description: "Купите первого производителя", threshold: 1, check: () => Object.values(producers).some(p => p.owned > 0), icon: "🏭" },
            { id: "cookie-farmer", name: "Фермер печенек", description: "Купите 10 ферм", threshold: 10, check: () => producers.farm.owned >= 10, icon: "👨‍🌾" },
            { id: "golden-cookie", name: "Золотоискатель", description: "Кликните по золотому печенью", threshold: 1, check: () => goldenCookiesClicked > 0, icon: "🌟" },
            { id: "prestige", name: "Престиж", description: "Пройдите первый престиж", threshold: 1, check: () => prestigeLevel > 0, icon: "⭐" },
            { id: "click-master", name: "Мастер клика", description: "Сделайте 1,000 кликов", threshold: 1000, check: () => totalCookiesClicked >= 1000, icon: "👆" },
            { id: "idle-player", name: "Игрок без дела", description: "Получите 10,000 печенек без кликов", threshold: 10000, check: () => totalCookiesProduced >= 10000 && totalCookiesClicked === 0, hidden: true, icon: "😴" }
        ];
        
        // Инициализация игры
        function initGame() {
            loadGame();
            setupUI();
            updateDisplay();
            
            // Обработчики событий
            document.getElementById('cookie').addEventListener('click', clickCookie);
            document.getElementById('save-btn').addEventListener('click', saveGame);
            document.getElementById('load-btn').addEventListener('click', loadGame);
            document.getElementById('reset-btn').addEventListener('click', resetGame);
            document.getElementById('prestige-button').addEventListener('click', doPrestige);
            
            // Табы
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', switchTab);
            });
            
            // Игровой цикл
            setInterval(gameLoop, 1000);
            
            // Золотые печенья
            setInterval(spawnGoldenCookie, 30000);
            
            // Автосохранение
            setInterval(autoSave, 30000);
            
            // Восстановление оффлайн-прогресса
            calculateOfflineProgress();
            
            // Уведомление о загрузке
            showNotification("Игра загружена! 🎮");
        }
        
        // Настройка UI
        function setupUI() {
            // Производители
            const producersTab = document.getElementById('producers-tab');
            for (const [id, producer] of Object.entries(producers)) {
                producersTab.appendChild(createUpgradeElement(id, producer));
            }
            
            // Улучшения клика
            const clickTab = document.getElementById('click-tab');
            for (const [id, upgrade] of Object.entries(clickUpgrades)) {
                clickTab.appendChild(createUpgradeElement(id, upgrade));
            }
            
            // Престижные улучшения
            const prestigeTab = document.getElementById('prestige-tab');
            for (const [id, upgrade] of Object.entries(prestigeUpgrades)) {
                prestigeTab.appendChild(createUpgradeElement(id, upgrade));
            }
            
            // Достижения
            const achievementsContainer = document.getElementById('achievements-container');
            achievements.forEach(achievement => {
                achievementsContainer.appendChild(createAchievementElement(achievement));
            });
        }
        
        // Создание элемента улучшения
        function createUpgradeElement(id, upgrade) {
            const element = document.createElement('div');
            element.className = 'upgrade';
            element.id = `upgrade-${id}`;
            element.innerHTML = `
                <div class="upgrade-name">
                    <span>${upgrade.icon || '✨'} ${upgrade.name}</span>
                    <span class="upgrade-owned">${upgrade.owned || 0}</span>
                </div>
                <div class="upgrade-description">${upgrade.description}</div>
                <div class="upgrade-stats">
                    <span class="upgrade-price">Цена: ${formatNumber(upgrade.price)}</span>
                </div>
                ${upgrade.max ? `<div class="progress-bar"><div class="progress-fill" style="width: ${(upgrade.owned / upgrade.max) * 100}%"></div></div>` : ''}
            `;
            element.addEventListener('click', () => buyUpgrade(id, upgrade.type || 'producer'));
            return element;
        }
        
        // Создание элемента достижения
        function createAchievementElement(achievement) {
            const element = document.createElement('div');
            element.className = 'achievement';
            element.id = `achievement-${achievement.id}`;
            if (achievement.hidden) element.style.display = 'none';
            element.innerHTML = `
                <div class="achievement-icon">${achievement.icon}</div>
                <div class="achievement-name">${achievement.name}</div>
                <div class="achievement-description">${achievement.description}</div>
            `;
            return element;
        }
        
        // Переключение табов
        function switchTab(e) {
            const tabId = e.target.dataset.tab;
            
            // Обновляем активный таб
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            e.target.classList.add('active');
            
            // Показываем соответствующий контейнер
            document.querySelectorAll('.upgrades-container').forEach(container => {
                container.style.display = 'none';
            });
            document.getElementById(`${tabId}-tab`).style.display = 'grid';
        }
        
        // Игровой цикл
        function gameLoop() {
            // Добавляем печеньки от производителей
            const produced = cookiesPerSecond * prestigeBonus;
            addCookies(produced);
            totalCookiesProduced += produced;
            
            // Обновляем отображение
            updateDisplay();
            
            // Проверяем достижения
            checkAchievements();
            
            // Проверяем доступность престижа
            checkPrestige();
        }
        
        // Клик по печеньке
        function clickCookie(e) {
            // Позиция клика
            const rect = e.target.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // Создаем эффект
            createClickEffect(x, y, 1 + getClickBonus());
            
            // Добавляем печеньки
            addCookies(1 + getClickBonus());
            totalCookiesClicked++;
        }
        
        // Создание эффекта клика
        function createClickEffect(x, y, amount) {
            const clickEffect = document.createElement('div');
            clickEffect.className = 'click-effect';
            clickEffect.textContent = `+${formatNumber(amount)}`;
            clickEffect.style.left = `${x}px`;
            clickEffect.style.top = `${y}px`;
            document.getElementById('cookie-container').appendChild(clickEffect);
            
            // Удаляем эффект после анимации
            setTimeout(() => {
                clickEffect.remove();
            }, 1000);
            
            // Анимация печеньки
            document.getElementById('cookie').style.transform = 'scale(0.95) rotate(-5deg)';
            setTimeout(() => {
                document.getElementById('cookie').style.transform = 'scale(1) rotate(0deg)';
            }, 100);
        }
        
        // Бонус за клик
        function getClickBonus() {
            let bonus = 0;
            
            // Базовые улучшения клика
            for (const upgrade of Object.values(clickUpgrades)) {
                bonus += upgrade.owned * upgrade.bonus;
            }
            
            // Престижные бонусы
            if (prestigeUpgrades.cookieMaster.owned) {
                bonus *= 1 + (prestigeUpgrades.cookieMaster.owned * prestigeUpgrades.cookieMaster.bonus);
            }
            
            return bonus;
        }
        
        // Добавление печенек
        function addCookies(amount) {
            cookies += amount;
            updateDisplay();
        }
        
        // Покупка улучшения
        function buyUpgrade(id, type = 'producer') {
            let upgrade;
            let upgradeType;
            
            if (type === 'click') {
                upgrade = clickUpgrades[id];
                upgradeType = 'click';
            } else if (type === 'prestige') {
                upgrade = prestigeUpgrades[id];
                upgradeType = 'prestige';
            } else {
                upgrade = producers[id];
                upgradeType = 'producer';
            }
            
            // Проверяем максимальный уровень
            if (upgrade.max && upgrade.owned >= upgrade.max) return;
            
            // Проверяем, достаточно ли печенек
            if (cookies >= upgrade.price) {
                cookies -= upgrade.price;
                upgrade.owned++;
                
                // Пересчитываем цену
                upgrade.price = Math.floor(upgrade.basePrice * Math.pow(upgrade.priceIncrease, upgrade.owned));
                
                // Обновляем игровые показатели
                if (type === 'producer') {
                    recalculateCPS();
                } else if (type === 'click') {
                    updateClickValue();
                }
                
                // Обновляем UI
                updateUpgradeUI(id, upgrade);
                updateDisplay();
                
                // Эффект покупки
                showNotification(`Куплено: ${upgrade.name} ${upgrade.icon || ''}`);
            } else {
                // Анимация при недостатке печенек
                const element = document.getElementById(`upgrade-${id}`);
                element.style.animation = 'none';
                void element.offsetWidth; // Trigger reflow
                element.style.animation = 'shake 0.5s';
            }
        }
        
        // Обновление UI улучшения
        function updateUpgradeUI(id, upgrade) {
            const element = document.getElementById(`upgrade-${id}`);
            if (!element) return;
            
            element.querySelector('.upgrade-owned').textContent = upgrade.owned;
            element.querySelector('.upgrade-price').textContent = `Цена: ${formatNumber(upgrade.price)}`;
            
            if (upgrade.max) {
                const progress = element.querySelector('.progress-fill');
                if (progress) {
                    progress.style.width = `${(upgrade.owned / upgrade.max) * 100}%`;
                }
            }
            
            // Отключаем, если достигнут максимум
            if (upgrade.max && upgrade.owned >= upgrade.max) {
                element.classList.add('disabled');
            }
        }
        
        // Пересчет печенек в секунду
        function recalculateCPS() {
            cookiesPerSecond = 0;
            
            // Базовые производители
            for (const producer of Object.values(producers)) {
                cookiesPerSecond += producer.owned * producer.cps;
            }
            
            // Престижные бонусы
            if (prestigeUpgrades.legacy.owned) {
                cookiesPerSecond *= 1 + (prestigeUpgrades.legacy.owned * prestigeUpgrades.legacy.bonus);
            }
        }
        
        // Обновление значения клика
        function updateClickValue() {
            document.getElementById('click-value').textContent = formatNumber(1 + getClickBonus());
        }
        
        // Обновление отображения
        function updateDisplay() {
            document.getElementById('cookies').textContent = formatNumber(cookies);
            document.getElementById('cps').textContent = formatNumber(cookiesPerSecond * prestigeBonus);
            updateClickValue();
            
            // Обновляем состояние кнопки престижа
            checkPrestige();
            
            // Обновляем видимость улучшений
            updateUpgradesVisibility();
        }
        
        // Обновление видимости улучшений
        function updateUpgradesVisibility() {
            for (const [id, producer] of Object.entries(producers)) {
                const element = document.getElementById(`upgrade-${id}`);
                if (element) {
                    if (cookies >= producer.unlockAt || producer.owned > 0) {
                        element.style.display = 'block';
                    } else {
                        element.style.display = 'none';
                    }
                }
            }
            
            for (const achievement of achievements) {
                if (achievement.hidden) {
                    const element = document.getElementById(`achievement-${achievement.id}`);
                    if (element && isAchievementUnlocked(achievement)) {
                        element.style.display = 'block';
                    }
                }
            }
        }
        
        // Проверка достижений
        function checkAchievements() {
            achievements.forEach(achievement => {
                const element = document.getElementById(`achievement-${achievement.id}`);
                if (!element) return;
                
                if (isAchievementUnlocked(achievement)) {
                    element.classList.add('unlocked');
                }
            });
        }
        
        // Проверка, разблокировано ли достижение
        function isAchievementUnlocked(achievement) {
            if (achievement.check) {
                return achievement.check();
            } else if (achievement.threshold) {
                if (achievement.id.includes('cookie')) {
                    return cookies >= achievement.threshold;
                } else if (achievement.id.includes('click')) {
                    return totalCookiesClicked >= achievement.threshold;
                }
            }
            return false;
        }
        
        // Появление золотого печенья
        function spawnGoldenCookie() {
            // Проверяем шанс появления (20% + бонусы)
            const baseChance = 0.2;
            const goldenLuckBonus = prestigeUpgrades.goldenLuck.owned * prestigeUpgrades.goldenLuck.bonus;
            const spawnChance = baseChance + goldenLuckBonus;
            
            if (Math.random() > spawnChance) return;
            
            const goldenCookie = document.getElementById('golden-cookie');
            
            // Позиция
            const x = Math.random() * (window.innerWidth - 100);
            const y = Math.random() * (window.innerHeight - 100);
            
            goldenCookie.style.left = `${x}px`;
            goldenCookie.style.top = `${y}px`;
            goldenCookie.style.display = 'block';
            
            // Обработчик клика
            goldenCookie.onclick = function() {
                goldenCookiesClicked++;
                
                // Случайный бонус
                const bonusTypes = [
                    { type: 'cookies', chance: 0.6, getAmount: () => Math.floor(cookiesPerSecond * 30 * (1 + Math.random())) },
                    { type: 'multiplier', chance: 0.3, getAmount: () => 2, duration: 30 },
                    { type: 'clickStorm', chance: 0.1, duration: 10 }
                ];
                
                const selectedBonus = selectRandomBonus(bonusTypes);
                applyGoldenCookieBonus(selectedBonus, x, y);
                
                goldenCookie.style.display = 'none';
                goldenCookie.onclick = null;
                
                // Проверяем достижения
                checkAchievements();
                
                // Снова появляется через случайное время
                setTimeout(spawnGoldenCookie, 15000 + Math.random() * 45000);
            };
            
            // Исчезает через 15 секунд, если не кликнули
            setTimeout(() => {
                if (goldenCookie.style.display === 'block') {
                    goldenCookie.style.display = 'none';
                    goldenCookie.onclick = null;
                    setTimeout(spawnGoldenCookie, 15000 + Math.random() * 45000);
                }
            }, 15000);
        }
        
        // Выбор случайного бонуса
        function selectRandomBonus(bonusTypes) {
            const total = bonusTypes.reduce((sum, type) => sum + type.chance, 0);
            let random = Math.random() * total;
            
            for (const type of bonusTypes) {
                if (random < type.chance) {
                    return type;
                }
                random -= type.chance;
            }
            
            return bonusTypes[0]; // fallback
        }
        
        // Применение бонуса золотого печенья
        function applyGoldenCookieBonus(bonus, x, y) {
            let message = "";
            
            if (bonus.type === 'cookies') {
                const amount = bonus.getAmount();
                addCookies(amount);
                message = `+${formatNumber(amount)} печенек!`;
                
                // Эффект
                createClickEffect(x, y, amount, true);
            } 
            else if (bonus.type === 'multiplier') {
                const multiplier = bonus.getAmount();
                const originalCPS = cookiesPerSecond;
                cookiesPerSecond *= multiplier;
                message = `x${multiplier} к производству на ${bonus.duration} сек!`;
                
                // Возвращаем исходное значение через duration секунд
                setTimeout(() => {
                    cookiesPerSecond = originalCPS;
                    showNotification("Бонус производства закончился");
                }, bonus.duration * 1000);
            }
            else if (bonus.type === 'clickStorm') {
                message = `ШТОРМ КЛИКОВ на ${bonus.duration} сек!`;
                startClickStorm(bonus.duration);
            }
            
            showNotification(`Золотое печенье: ${message}`, true);
        }
        
        // Шторм кликов
        function startClickStorm(duration) {
            const stormInterval = setInterval(() => {
                // Случайная позиция на печеньке
                const cookie = document.getElementById('cookie-container');
                const rect = cookie.getBoundingClientRect();
                const x = Math.random() * rect.width;
                const y = Math.random() * rect.height;
                
                // Автоклик
                createClickEffect(x, y, 1 + getClickBonus());
                addCookies(1 + getClickBonus());
                totalCookiesClicked++;
            }, 100);
            
            // Останавливаем шторм через duration секунд
            setTimeout(() => {
                clearInterval(stormInterval);
                showNotification("Шторм кликов закончился");
            }, duration * 1000);
        }
        
        // Проверка доступности престижа
        function checkPrestige() {
            const nextPrestige = Math.floor(1000000 * Math.pow(2, prestigeLevel));
            const prestigeButton = document.getElementById('prestige-button');
            
            document.getElementById('next-prestige').textContent = formatNumber(nextPrestige);
            
            if (cookies >= nextPrestige) {
                prestigeButton.disabled = false;
                prestigeButton.classList.add('rainbow-text');
            } else {
                prestigeButton.disabled = true;
                prestigeButton.classList.remove('rainbow-text');
            }
        }
        
        // Престиж
        function doPrestige() {
            const nextPrestige = Math.floor(1000000 * Math.pow(2, prestigeLevel));
            
            if (cookies < nextPrestige) return;
            
            if (confirm(`Вы уверены, что хотите престиж? Вы получите ${Math.floor(Math.sqrt(cookies / 1000000))} престижных очков, но потеряете все печенья и улучшения.`)) {
                // Рассчитываем очки престижа
                const pointsGained = Math.floor(Math.sqrt(cookies / 1000000));
                prestigePoints += pointsGained;
                prestigeLevel++;
                prestigeBonus = 1 + (prestigeLevel * 0.1);
                
                // Сбрасываем игру
                cookies = 0;
                cookiesPerSecond = 0;
                cookiesPerClick = 1;
                totalCookiesClicked = 0;
                totalCookiesProduced = 0;
                
                // Сбрасываем производителей
                for (const producer of Object.values(producers)) {
                    producer.owned = 0;
                    producer.price = producer.basePrice;
                }
                
                // Сбрасываем улучшения клика
                for (const upgrade of Object.values(clickUpgrades)) {
                    upgrade.owned = 0;
                    upgrade.price = upgrade.basePrice;
                }
                
                // Обновляем UI
                updateDisplay();
                document.getElementById('prestige-level').textContent = prestigeLevel;
                document.getElementById('prestige-points').textContent = prestigePoints;
                document.getElementById('prestige-bonus').textContent = prestigeBonus.toFixed(1);
                
                // Обновляем все улучшения в UI
                for (const [id, producer] of Object.entries(producers)) {
                    updateUpgradeUI(id, producer);
                }
                
                for (const [id, upgrade] of Object.entries(clickUpgrades)) {
                    updateUpgradeUI(id, upgrade);
                }
                
                // Показываем уведомление
                showNotification(`Престиж ${prestigeLevel}! Получено ${pointsGained} очков престижа`, true);
                
                // Сохраняем игру
                saveGame();
            }
        }
        
        // Показать уведомление
        function showNotification(message, isImportant = false) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.classList.add('show');
            
            if (isImportant) {
                notification.style.background = 'linear-gradient(135deg, #FF5722, #FF9800)';
            } else {
                notification.style.background = 'rgba(0,0,0,0.8)';
            }
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, isImportant ? 3000 : 2000);
        }
        
        // Форматирование чисел
        function formatNumber(num) {
            if (num >= 1e12) return (num / 1e12).toFixed(1) + 'T';
            if (num >= 1e9) return (num / 1e9).toFixed(1) + 'B';
            if (num >= 1e6) return (num / 1e6).toFixed(1) + 'M';
            if (num >= 1e3) return (num / 1e3).toFixed(1) + 'K';
            return Math.floor(num).toString();
        }
        
        // Сохранение игры
        function saveGame() {
            gameState = {
                lastUpdate: Date.now(),
                cookies: cookies,
                upgrades: {
                    producers: {},
                    click: {},
                    prestige: {}
                },
                achievements: [],
                stats: {
                    totalCookiesClicked: totalCookiesClicked,
                    totalCookiesProduced: totalCookiesProduced,
                    goldenCookiesClicked: goldenCookiesClicked
                },
                prestige: {
                    level: prestigeLevel,
                    points: prestigePoints,
                    bonus: prestigeBonus
                },
                version: gameVersion
            };
            
            // Сохраняем производителей
            for (const [id, producer] of Object.entries(producers)) {
                gameState.upgrades.producers[id] = {
                    owned: producer.owned,
                    price: producer.price
                };
            }
            
            // Сохраняем улучшения клика
            for (const [id, upgrade] of Object.entries(clickUpgrades)) {
                gameState.upgrades.click[id] = {
                    owned: upgrade.owned,
                    price: upgrade.price
                };
            }
            
            // Сохраняем престижные улучшения
            for (const [id, upgrade] of Object.entries(prestigeUpgrades)) {
                gameState.upgrades.prestige[id] = {
                    owned: upgrade.owned,
                    price: upgrade.price
                };
            }
            
            // Сохраняем достижения
            gameState.achievements = achievements
                .filter(achievement => isAchievementUnlocked(achievement))
                .map(achievement => achievement.id);
            
            localStorage.setItem('ultimateCookieClickerSave', JSON.stringify(gameState));
            
            showNotification("Игра сохранена! 💾");
        }
        
        // Загрузка игры
        function loadGame() {
            const savedData = localStorage.getItem('ultimateCookieClickerSave');
            
            if (savedData) {
                try {
                    const loadedState = JSON.parse(savedData);
                    
                    // Проверка версии
                    if (loadedState.version !== gameVersion) {
                        showNotification("Версия сохранения устарела, некоторые данные могут быть потеряны");
                    }
                    
                    // Основные данные
                    cookies = loadedState.cookies || 0;
                    
                    // Производители
                    if (loadedState.upgrades?.producers) {
                        for (const [id, data] of Object.entries(loadedState.upgrades.producers)) {
                            if (producers[id]) {
                                producers[id].owned = data.owned || 0;
                                producers[id].price = data.price || producers[id].basePrice;
                            }
                        }
                    }
                    
                    // Улучшения клика
                    if (loadedState.upgrades?.click) {
                        for (const [id, data] of Object.entries(loadedState.upgrades.click)) {
                            if (clickUpgrades[id]) {
                                clickUpgrades[id].owned = data.owned || 0;
                                clickUpgrades[id].price = data.price || clickUpgrades[id].basePrice;
                            }
                        }
                    }
                    
                    // Престижные улучшения
                    if (loadedState.upgrades?.prestige) {
                        for (const [id, data] of Object.entries(loadedState.upgrades.prestige)) {
                            if (prestigeUpgrades[id]) {
                                prestigeUpgrades[id].owned = data.owned || 0;
                                prestigeUpgrades[id].price = data.price || prestigeUpgrades[id].basePrice;
                            }
                        }
                    }
                    
                    // Статистика
                    if (loadedState.stats) {
                        totalCookiesClicked = loadedState.stats.totalCookiesClicked || 0;
                        totalCookiesProduced = loadedState.stats.totalCookiesProduced || 0;
                        goldenCookiesClicked = loadedState.stats.goldenCookiesClicked || 0;
                    }
                    
                    // Престиж
                    if (loadedState.prestige) {
                        prestigeLevel = loadedState.prestige.level || 0;
                        prestigePoints = loadedState.prestige.points || 0;
                        prestigeBonus = loadedState.prestige.bonus || 1;
                    }
                    
                    // Пересчет показателей
                    recalculateCPS();
                    updateClickValue();
                    
                    // Обновляем престиж UI
                    document.getElementById('prestige-level').textContent = prestigeLevel;
                    document.getElementById('prestige-points').textContent = prestigePoints;
                    document.getElementById('prestige-bonus').textContent = prestigeBonus.toFixed(1);
                    
                    // Восстанавливаем достижения
                    if (Array.isArray(loadedState.achievements)) {
                        loadedState.achievements.forEach(achievementId => {
                            const achievement = achievements.find(a => a.id === achievementId);
                            if (achievement) {
                                const element = document.getElementById(`achievement-${achievement.id}`);
                                if (element) element.classList.add('unlocked');
                            }
                        });
                    }
                    
                    showNotification("Игра загружена! 🎮");
                } catch (e) {
                    console.error("Ошибка загрузки сохранения:", e);
                    showNotification("Ошибка загрузки сохранения 😢");
                }
            }
        }
        
        // Расчет оффлайн-прогресса
        function calculateOfflineProgress() {
            if (gameState.lastUpdate) {
                const now = Date.now();
                const diff = now - gameState.lastUpdate;
                const offlineSeconds = Math.min(diff / 1000, 86400); // Максимум 24 часа
                
                if (offlineSeconds > 10) { // Минимум 10 секунд
                    const offlineCookies = cookiesPerSecond * offlineSeconds * 0.5 * prestigeBonus; // 50% от обычного производства
                    if (offlineCookies > 0) {
                        addCookies(offlineCookies);
                        totalCookiesProduced += offlineCookies;
                        showNotification(`Пока вас не было: ${formatNumber(offlineCookies)} печенек (${formatTime(offlineSeconds)})`, true);
                    }
                }
            }
        }
        
        // Форматирование времени
        function formatTime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = Math.floor(seconds % 60);
            
            return [
                hours > 0 ? `${hours}ч` : '',
                minutes > 0 ? `${minutes}м` : '',
                `${secs}с`
            ].filter(Boolean).join(' ');
        }
        
        // Автосохранение
        function autoSave() {
            saveGame();
            showNotification("Игра автосохранена");
        }
        
        // Сброс игры
        function resetGame() {
            if (confirm("Вы уверены, что хотите полностью сбросить игру? Все ваши сохранения будут удалены.")) {
                // Сбрасываем переменные
                cookies = 0;
                cookiesPerSecond = 0;
                cookiesPerClick = 1;
                totalCookiesClicked = 0;
                totalCookiesProduced = 0;
                prestigeLevel = 0;
                prestigePoints = 0;
                prestigeBonus = 1;
                goldenCookiesClicked = 0;
                
                // Сбрасываем производителей
                for (const producer of Object.values(producers)) {
                    producer.owned = 0;
                    producer.price = producer.basePrice;
                }
                
                // Сбрасываем улучшения клика
                for (const upgrade of Object.values(clickUpgrades)) {
                    upgrade.owned = 0;
                    upgrade.price = upgrade.basePrice;
                }
                
                // Сбрасываем престижные улучшения
                for (const upgrade of Object.values(prestigeUpgrades)) {
                    upgrade.owned = 0;
                    upgrade.price = upgrade.basePrice;
                }
                
                // Пересчет показателей
                recalculateCPS();
                updateClickValue();
                
                // Обновляем UI
                updateDisplay();
                document.getElementById('prestige-level').textContent = prestigeLevel;
                document.getElementById('prestige-points').textContent = prestigePoints;
                document.getElementById('prestige-bonus').textContent = prestigeBonus.toFixed(1);
                
                // Обновляем все улучшения в UI
                for (const [id, producer] of Object.entries(producers)) {
                    updateUpgradeUI(id, producer);
                }
                
                for (const [id, upgrade] of Object.entries(clickUpgrades)) {
                    updateUpgradeUI(id, upgrade);
                }
                
                // Сбрасываем достижения
                document.querySelectorAll('.achievement').forEach(el => {
                    el.classList.remove('unlocked');
                });
                
                // Удаляем сохранение
                localStorage.removeItem('ultimateCookieClickerSave');
                
                showNotification("Игра сброшена! 🔄", true);
            }
        }
        
        // Запуск игры при загрузке страницы
        window.onload = initGame;
    </script>
</body>
</html>
